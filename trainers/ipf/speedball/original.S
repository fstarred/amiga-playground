AllocMem	= -198	;$00C6
DoIo		= -456	;$01C8

	AUTO	WS\BOOTBLOCK\0\2\CC\

BOOTBLOCK:
	DC.B	'DOS',0
	DC.L	0
	DC.L	880
LB_0000	
	MOVE.L	A1,A4
	MOVE.L	$00000004,A6
	LEA	LB_0022(PC),A0
	MOVE.L	A0,$00000014
	MOVEQ	#$00,D0
	DIVU.W	D0,D0
LB_0022	MOVE.L	#$0007FFFC,A7
	MOVE.L	#$00019000,D7
	MOVE.L	D7,D0
	MOVE.L	#$00010002,D1
	JSR	AllocMem(A6)
	TST.L	D0
	BEQ.W	LB_006C
	MOVE.L	D0,A5
	MOVEQ	#$40,D0
	ADD.L	D0,D0
	MOVE.L	D0,-(A7)
	PEA	LB_0000(PC)
	MOVE.L	A5,A3
	ADDA.L	#$0000C800,A5
	MOVE.L	#$0004E780,D0
	MOVE.L	#$00010004,D1
	JSR	AllocMem(A6)
	MOVE.L	D0,$00000024
	BRA.B	LB_0084
LB_006C	JSR	-$0078(A6)
	JSR	-$0096(A6)
	MOVE.L	#$4E704EF9,$00000000
	JMP	$00000000
LB_0084	MOVE.L	#$00000001,$0024(A4)
	MOVE.W	#$0009,$001C(A4)
	MOVE.L	A4,A1
	MOVE.L	$00000004,A6
	JSR	DoIo(A6)
	MOVE.L	#$00000400,$0024(A4)
	LEA	LB_0000(PC),A1
	MOVE.L	A1,$0028(A4)
	MOVE.W	#$0002,$001C(A4)
	MOVE.L	#$00000400,$002C(A4)
	MOVE.L	$00000004,A6
	MOVE.L	A4,A1
	MOVE.L	A5,A0
	JMP	DoIo(A6)
	MOVEM.L	A3/A5,-(A7)
	MOVE.L	A5,A0
	MOVE.L	A3,A5
	BSR.W	LB_0120
	MOVEM.L	(A7)+,A3/A5
	MOVE.L	#$00000000,$0024(A4)
	MOVE.W	#$0009,$001C(A4)
	MOVE.L	$00000004,A6
	MOVE.L	A4,A1
	MOVE.L	A5,A6
	MOVE.W	#$2BFF,D0
LB_00F6	CLR.L	(A6)+
	DBF	D0,LB_00F6
	MOVE.L	A4,A6
	MOVE.W	$00DFF002,D0
	ORI.W	#$83C0,D0
	MOVE.W	D0,$00DFF096
	MOVE.W	$00DFF01C,D0
	ORI.W	#$8070,D0
	MOVE.W	D0,$00DFF09A
	JSR	(A3)
LB_0120	MOVE.L	A5,A2
	MOVE.L	(A1)+,D3
	ADD.L	D2,$00(A2,D3.L)
	SUBQ.L	#1,D0
	RTS	
