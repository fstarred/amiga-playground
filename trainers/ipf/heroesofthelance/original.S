
Doio	= -456	;-$01C8
AllocMem= -198	;-$00C6

	AUTO	WS\START\0\2\CC\

START
	DC.B	'DOS',$00
	DC.B	'@)',$DE,'6'
	DC.L	0


	MOVE.L	A1,A3
	CLR.W	$00DFF180
	MOVE.L	#$00078000,A7
	MOVE.L	#$00010002,D1		; MEMF_CHIP
	MOVE.L	#$0007A800,D0
	MOVE.L	D0,$0024(A3)
	MOVE.L	$0004.W,A6
	JSR	-$00C6(A6)
	MOVE.L	#$00010002,D1		; MEMF_CHIP
	MOVE.L	#$00064000,D0
	MOVE.L	D0,$0024(A3)
	MOVE.L	$0004.W,A6
	JSR	-$00C6(A6)
	MOVE.L	D0,$00000110
	MOVE.L	#$0000A400,D0
	MOVE.L	D0,A5
	MOVE.L	A3,A1
	MOVE.L	D0,$0028(A1)		; buffer
	MOVE.W	#$0002,$001C(A1)	; command: read
	MOVE.L	#$00000200,$0024(A1)	; len
	MOVE.L	#$00000400,$002C(A1)	; offset
	MOVE.L	$0004.W,A6
	JSR	-$01C8(A6)
	MOVE.W	#$001F,D0
	MOVE.L	A5,A0
	MOVE.L	#$41455845,D1
LB_0088	CMP.L	(A0),D1
	BEQ.W	LB_009A
	ADDA.W	#$0010,A0
	DBF	D0,LB_0088
	BRA.W	LB_013E
LB_009A	MOVE.L	A3,A1
	MOVE.L	A5,$0028(A1)		; buffer
	MOVE.W	#$0002,$001C(A1)	; command: read
	MOVE.W	$000C(A0),D0
	MULU.W	#$0200,D0
	MOVE.L	D0,$002C(A1)		; offset
	MOVE.W	$000E(A0),D0
	MULU.W	#$0200,D0
	MOVE.L	D0,$0024(A1)		; len
	MOVE.L	$0004.W,A6
	JSR	-$01C8(A6)
	BSR.W	LB_0146
	MOVE.L	A5,A6
	CMPI.W	#$601A,(A5)
	BNE.W	LB_00DC
	BSR.W	LB_015C
	LEA	$001C(A5),A6
LB_00DC	MOVE.W	#$4200,$00DFF100
	MOVE.W	#$0038,$00DFF092
	MOVE.W	#$00D0,$00DFF094
	MOVE.W	#$2C81,$00DFF08E
	MOVE.W	#$F4C1,$00DFF090
	MOVE.W	$00DFF002,D0
	ORI.W	#$8380,D0
	MOVE.W	D0,$00DFF096
	LEA	LB_019A(PC),A0
	MOVE.L	A0,$00DFF080
	MOVE.W	$00DFF088,D0
	CLR.L	D0
	MOVE.L	D0,D1
	MOVE.L	D0,D2
	MOVE.L	D0,D3
	MOVE.L	D0,D4
	MOVE.L	D0,D5
	MOVE.L	D0,D6
	MOVE.L	D0,D7
	MOVE.L	D0,A0
	MOVE.L	D0,A1
	MOVE.L	D0,A2
	MOVE.L	D0,A4
	JMP	(A6)
LB_013E	BSR.W	LB_0146
LB_0142	BRA.W	LB_0142
LB_0146	MOVE.L	A3,A1
	MOVE.W	#$0009,$001C(A1)	; command: motor on/off
	CLR.L	$0024(A3)
	MOVE.L	$0004.W,A6
	JSR	-$01C8(A6)
	RTS	
LB_015C	MOVE.L	A5,A0
	ADDA.L	#$0000001C,A0
	MOVE.L	A0,A1
	MOVE.L	A0,D0
	ADDA.L	$0002(A5),A0
	ADDA.L	$0006(A5),A0
	ADDA.L	$000E(A5),A0
	MOVE.L	(A0)+,D2
	BEQ.B	LB_0198
	ADDA.L	D2,A1
LB_017A	ADD.L	D0,(A1)
LB_017C	MOVE.B	(A0),D1
	BEQ.B	LB_0198
	CLR.B	(A0)+
	CMP.B	#$01,D1
	BNE.B	LB_018E
	LEA	$00FE(A1),A1
	BRA.B	LB_017C
LB_018E	ANDI.L	#$000000FF,D1
	ADDA.L	D1,A1
	BRA.B	LB_017A
LB_0198	RTS	
LB_019A	DC	$00E0
	ORI.B	#$E2,D7
	OR.B	D0,D0
	DC	$00E4
	ORI.B	#$E6,D7
	LINE_A	#$0000
	DC	$00E8
	ORI.B	#$EA,D7
	AND.B	D0,D0
	DC	$00EC
	ORI.B	#$EE,D7
	ASR.B	#8,D0
	LINE_F	#$0FFF
	LINE_F	#$0FFE
	ORI.B	#$00,D0
	BSET	D1,$00(A2,D0.W)

