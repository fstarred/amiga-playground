***************************************
*
*      Batman the movie (1989)
*
*  Original IPF, Tosec 2012-04-10
*
*
***************************************

* RNC Copy protection
*
* overwrite the part of the copy protection begin
* with setting the magic number both on D0 and address $24
* then jump to $13C2 address (see last PEA of the copy protection)
*
* That's it !!!

BOOTBLOCK

	AUTO	WS\BOOTBLOCK\0\2\CC\

	DC.B	'DOS',0
	DC.L	0
	DC.L	880

LB_000C	BRA.B	LB_0018
LB_000E	MOVE.W	(A0)+,(A1)+
	SUBQ.L	#1,D0
	BNE.B	LB_000E
	JMP	$04C8.W
LB_0018	LEA	$00DFF000,A6
	LEA	$00BFD100,A5
	LEA	$00BFE101,A4
	MOVEQ	#$00,D0
	MOVEQ	#-$01,D1
	MOVE.W	#$7FFF,$009A(A6)
	MOVE.W	#$1FFF,$0096(A6)
	MOVE.W	D0,$0180(A6)
	MOVE.W	#$0200,$0100(A6)
	MOVE.L	D0,$0102(A6)
	MOVE.W	#$4000,$0024(A6)
	MOVE.L	D0,$0040(A6)
	MOVE.W	#$0041,$0058(A6)
	MOVE.W	#$8240,$0096(A6)
	LEA	LB_0068(PC),A0
	MOVE.L	A0,$0080.W
	TRAP	#$0
LB_0068	MOVE.B	#$7F,$0C00(A4)
	MOVE.B	#$7F,$0C00(A5)
	MOVE.B	D0,$0D00(A4)
	MOVE.B	D0,$0E00(A4)
	MOVE.B	D0,$0D00(A5)
	MOVE.B	D0,$0E00(A5)
	MOVE.B	D0,-$0100(A4)
	MOVE.B	#$03,$0100(A4)
	MOVE.B	D0,(A4)
	MOVE.B	D1,$0200(A4)
	MOVE.B	#$C0,-$0100(A5)
	MOVE.B	#$C0,$0100(A5)
	MOVE.B	D1,(A5)
	MOVE.B	D1,$0200(A5)
	LEA	LB_000E(PC),A0
	LEA	$040E.W,A1
	MOVEQ	#$04,D0
LB_00B0	MOVE.W	(A0)+,(A1)+
	DBF	D0,LB_00B0
	LEA	LB_0018(PC),A0
	LEA	$0418.W,A1
	MOVE.L	#$000001F4,D0
	JMP	$040E.W
	LEA	$0007C000,A7
	LEA	LB_03BE(PC),A0
	MOVE.L	A0,$0078.W
	MOVE.W	#$7FFF,$009C(A6)
	TST.B	$0C00(A5)
	MOVE.B	#$83,$0C00(A5)
	MOVE.W	#$E000,$009A(A6)
	ORI.B	#$FF,(A5)
	ANDI.B	#$7F,(A5)
	ANDI.B	#$F7,(A5)
	BSR.W	LB_0190
	MOVEQ	#$00,D0
	LEA	$0800.W,A0
	BSR.B	LB_0158
	MOVE.W	$041E(A0),D0
	MOVE.L	#$00FFFFFF,D1
	AND.L	$041A(A0),D1
	DIVU.W	#$0200,D1
	ADD.W	D0,D1
	EXT.L	D0
	DIVU.W	#$000B,D0
	MOVE.L	D0,D2
	SWAP	D2
	MULU.W	#$0200,D2
	PEA	$00(A0,D2.L)
	EXT.L	D1
	DIVU.W	#$000B,D1
	SUB.W	D0,D1
LB_0132	BSR.B	LB_0158
	ADDA.W	#$1600,A0
	ADDQ.W	#1,D0
	DBF	D1,LB_0132
	ORI.B	#$FF,(A5)
	ANDI.B	#$F7,(A5)
	ORI.B	#$FF,(A5)
	MOVE.W	#$0F00,$0180(A6)
	MOVE.W	#$7FFF,$009A(A6)
CRACK
	MOVE.W	#$0EC0,A5
	MOVE.L	#$203CFF7E,(A5)+
	MOVE.L	#$EFAB21C0,(A5)+
	MOVE.L	#$00244EF8,(A5)+
	MOVE.L	#$13C2C000,(A5)
	RTS	
LB_0158	MOVEM.L	D1/A0/A1,-(A7)
LB_015C	MOVEQ	#$07,D6
LB_015E	BTST	#$05,-$0100(A4)
	BNE.B	LB_015E
	BSR.B	LB_019E
LB_0168	LEA	$0007C000,A0
	BSR.W	LB_0224
	LEA	$0007C000,A0
	MOVE.L	$0004(A7),A1
	BSR.W	LB_0286
	BEQ.B	LB_018A
	DBF	D6,LB_0168
	BSR.B	LB_0190
	BRA.B	LB_015C
LB_018A	MOVEM.L	(A7)+,D1/A0/A1
	RTS	
LB_0190	MOVE.L	D0,-(A7)
	MOVE.W	#$00A6,D7
	CLR.W	D0
	BSR.B	LB_019E
	MOVE.L	(A7)+,D0
	RTS	
LB_019E	BSET	#$02,(A5)
	BCLR	#$00,D7
	BTST	#$00,D0
	BEQ.B	LB_01B4
	BCLR	#$02,(A5)
	BSET	#$00,D7
LB_01B4	CMP.W	D7,D0
	BEQ.B	LB_01F8
	BPL.B	LB_01D0
	BSET	#$01,(A5)
LB_01BE	BTST	#$04,-$0100(A4)
	BEQ.B	LB_01DE
	BSR.B	LB_01FA
	SUBQ.W	#2,D7
	CMP.W	D7,D0
	BNE.B	LB_01BE
	BRA.B	LB_01E0
LB_01D0	BCLR	#$01,(A5)
LB_01D4	BSR.B	LB_01FA
	ADDQ.W	#2,D7
	CMP.W	D7,D0
	BNE.B	LB_01D4
	BRA.B	LB_01E0
LB_01DE	CLR.W	D7
LB_01E0	MOVE.B	#$F4,$0300(A5)
	MOVE.B	#$29,$0400(A5)
	SF	D5
	MOVE.B	#$19,$0D00(A5)
LB_01F4	TST.B	D5
	BEQ.B	LB_01F4
LB_01F8	RTS	
LB_01FA	MOVE.B	#$C8,$0300(A5)
	MOVE.B	#$10,$0400(A5)
CUSTOM
;	BCLR	#$00,(A5)	; REPEATED INSTRUCTIONS CAN BE AVOIDED I GUESS
;	BCLR	#$00,(A5)
	BCLR	#$00,(A5)
	BSET	#$00,(A5)
	SF	D5
	MOVE.B	#$19,$0D00(A5)
LB_021E	TST.B	D5
	BEQ.B	LB_021E
	RTS	
LB_0224	MOVEM.L	D0/A0,-(A7)
LB_0228	BTST	#$05,-$0100(A4)
	BNE.B	LB_0228
	MOVE.W	#$4000,$0024(A6)
	MOVE.W	#$8010,$0096(A6)
	MOVE.W	#$7F00,$009E(A6)
	MOVE.W	#$9500,$009E(A6)
	MOVE.W	#$4489,$007E(A6)
	MOVE.L	$0004(A7),A0
	MOVE.W	#$4489,(A0)+
	MOVE.L	A0,$0020(A6)
	MOVE.W	#$0002,$009C(A6)
	MOVE.W	#$9BFF,D0
	MOVE.W	D0,$0024(A6)
	MOVE.W	D0,$0024(A6)
LB_026C	MOVEQ	#$02,D0
	AND.W	$001E(A6),D0
	BEQ.B	LB_026C
	MOVE.W	#$0010,$0096(A6)
	MOVE.W	#$4000,$0024(A6)
	MOVEM.L	(A7)+,D0/A0
	RTS	
LB_0286	MOVEM.L	D0-D2/A0,-(A7)
	CLR.W	D1
	MOVE.W	#$19FF,D2
	SUBA.W	#$001C,A7
LB_0294	CMPI.W	#$4489,(A0)+
	DBEQ	D2,LB_0294
	BNE.W	LB_031A
LB_02A0	CMPI.W	#$4489,(A0)+
	DBNE	D2,LB_02A0
	BEQ.B	LB_031A
	SUBQ.L	#2,A0
	SUBQ.W	#1,D2
LB_02AE	MOVEM.L	A0/A1,-(A7)
	LEA	$0008(A7),A1
	MOVEQ	#$1C,D0
	BSR.W	LB_0340
	MOVEM.L	(A7)+,A0/A1
	MOVEQ	#$28,D0
	BSR.B	LB_0320
	CMP.L	$0014(A7),D0
	BNE.B	LB_0294
	MOVE.B	D7,D0
	CMP.B	$0001(A7),D0
	BNE.B	LB_031A
	LEA	$0038(A0),A0
	MOVE.W	#$0400,D0
	BSR.B	LB_0320
	CMP.L	$0018(A7),D0
	BNE.B	LB_0294
	MOVE.B	$0002(A7),D0
	BSET	D0,D1
	MOVE.L	A1,-(A7)
	EXT.W	D0
	MULU.W	#$0200,D0
	ADDA.W	D0,A1
	MOVE.W	#$0200,D0
	BSR.B	LB_0366
	MOVE.L	(A7)+,A1
	CMP.W	#$07FF,D1
	BEQ.B	LB_0310
	SUBI.W	#$021C,D2
	SUBQ.B	#1,$0003(A7)
	BEQ.B	LB_0294
	ADDQ.L	#8,A0
	SUBQ.W	#4,D2
	BRA.B	LB_02AE
LB_0310	ADDA.W	#$001C,A7
	MOVEM.L	(A7)+,D0-D2/A0
	RTS	
LB_031A	ANDI.B	#$FB,CCR
	BRA.B	LB_0310
LB_0320	MOVEM.L	D1/D2/A0,-(A7)
	LSR.W	#2,D0
	SUBQ.W	#1,D0
	MOVEQ	#$00,D1
LB_032A	MOVE.L	(A0)+,D2
	EOR.L	D2,D1
	DBF	D0,LB_032A
	ANDI.L	#$55555555,D1
	MOVE.L	D1,D0
	MOVEM.L	(A7)+,D1/D2/A0
	RTS	
LB_0340	MOVEM.L	D1-D3,-(A7)
	LSR.W	#2,D0
	SUBQ.W	#1,D0
	MOVE.L	#$55555555,D1
LB_034E	MOVE.L	(A0)+,D2
	MOVE.L	(A0)+,D3
	AND.L	D1,D2
	AND.L	D1,D3
	ADD.L	D2,D2
	ADD.L	D3,D2
	MOVE.L	D2,(A1)+
	DBF	D0,LB_034E
	MOVEM.L	(A7)+,D1-D3
	RTS	
LB_0366	MOVE.L	D1,-(A7)
LB_0368	BTST	#$0E,$0002(A6)
	BNE.B	LB_0368
	MOVEQ	#$00,D1
	MOVE.L	D1,$0064(A6)
	MOVE.L	D1,$0060(A6)
	MOVE.L	#$FFFFFFFF,$0044(A6)
	MOVE.W	#$5555,$0070(A6)
	ADDA.W	D0,A0
	SUBQ.L	#2,A0
	MOVE.L	A0,$0050(A6)
	ADDA.W	D0,A0
	MOVE.L	A0,$004C(A6)
	ADDQ.L	#2,A0
	ADDA.W	D0,A1
	SUBQ.W	#2,A1
	MOVE.L	A1,$0054(A6)
	ADDQ.W	#2,A1
	MOVE.L	#$1DD80002,$0040(A6)
	LSL.W	#5,D0
	ADDQ.W	#1,D0
	MOVE.W	D0,$0058(A6)
LB_03B2	BTST	#$0E,$0002(A6)
	BNE.B	LB_03B2
	MOVE.L	(A7)+,D1
	RTS	
LB_03BE	MOVE.L	D0,-(A7)
	MOVE.W	$001E(A6),D0
	BTST	#$0E,D0
	BNE.B	LB_03E0
	MOVE.B	$0C00(A5),D0
	BPL.B	LB_03D6
	LSR.B	#1,D0
	BCC.B	LB_03D6
	ST	D5
LB_03D6	MOVE.W	#$2000,$009C(A6)
	MOVE.L	(A7)+,D0
	RTE	
LB_03E0	MOVE.W	#$4000,$009C(A6)
	MOVE.L	(A7)+,D0
	RTE	
END
	PRINTV END-BOOTBLOCK
	IF (END-BOOTBLOCK)>1024
		FAIL BOOTBLOCK SIZE EXCEED
	ENDIF
